<!DOCTYPE html>
<html>
<head>
  <title>Module Configuration</title>
  <script>
    function addModule() {
      const container = document.getElementById('modulesContainer');
      const moduleCount = container.children.length + 1;

      const moduleDiv = document.createElement('div');
      moduleDiv.id = `module${moduleCount}`;
      moduleDiv.innerHTML = `
        <h3>Module ${moduleCount}</h3>
        <label for="name${moduleCount}">Name:</label><br>
        <input type="text" id="name${moduleCount}" name="name${moduleCount}"><br>
        <label for="maxPower${moduleCount}">Max Power:</label><br>
        <input type="number" step="0.01" id="maxPower${moduleCount}" name="maxPower${moduleCount}"><br>
        <label for="angle${moduleCount}">Angle:</label><br>
        <input type="number" id="angle${moduleCount}" name="angle${moduleCount}"><br><br>
      `;
      container.appendChild(moduleDiv);
    }

    function deleteModule(index) {
      fetch('/delete?index=' + index, { method: 'GET' })
        .then(response => response.text())
        .then(data => {
          alert(data);
          location.reload();
        });
    }

    function loadModules() {
      fetch('/modules', { method: 'GET' })
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('savedModulesContainer');
          container.innerHTML = '';
          data.modules.forEach((module, index) => {
            const moduleDiv = document.createElement('div');
            moduleDiv.innerHTML = `
              <h3>Module ${index + 1}</h3>
              <p>Name: ${module.name}</p>
              <p>Max Power: ${module.maxPower}</p>
              <p>Angle: ${module.angle}</p>
              <button type="button" onclick="deleteModule(${index})">Delete</button>
              <hr>
            `;
            container.appendChild(moduleDiv);
          });
        });
    }

    function deleteData() {
      fetch('/deleteAll', {
        method: 'POST'
      }).then(response => response.text()).then(data => {
        alert(data);
      }).catch(error => {
        console.error('Error:', error); // Debug output
      });
    }

    window.onload = loadModules;
  </script>
</head>
<body>
  <h2>Add Modules</h2>
  <form action="/add" method="post">
    <div id="modulesContainer">
      <div id="module1">
        <h3>Module 1</h3>
        <label for="name1">Name:</label><br>
        <input type="text" id="name1" name="name1"><br>
        <label for="maxPower1">Max Power:</label><br>
        <input type="number" step="0.01" id="maxPower1" name="maxPower1"><br>
        <label for="angle1">Angle:</label><br>
        <input type="number" id="angle1" name="angle1"><br><br>
      </div>
    </div>
    <button type="button" onclick="addModule()">Add Another Module</button><br><br>
    <input type="submit" value="Submit">
  </form>

  <button onclick="deleteData()">Delete Modules and WiFi Credentials</button>
  <hr>

  <h2> EMail Parameter</h2>
  <form action="/addEmailParams" method="post">
    <div id="emailContainer">
      <div id="emailParams">
        <h3>Module 1</h3>
        <label for="SMTPserver">SMTP Server:</label><br>
        <input type="text" id="SMTPserver" name="SMTPserver"><br>
        <label for="SMTPuser">SMTP Username:</label><br>
        <input type="text" id="SMTPuser" name="SMTPuser"><br>
        <label for="SMTPpass">SMTP Password:</label><br>
        <input type="text" id="SMTPpass" name="SMTPpass"><br>
        <label for="SMTPportTLS">SMTP Port (TLS):</label><br>
        <input type="number" id="SMTPportTLS" name="SMTPportTLS"><br>
        <label for="SMTPportSSL">SMTP Port (SSL):</label><br>
        <input type="number" id="SMTPportSSL" name="SMTPportSSL"><br>
        <label for="TLSSSL">TSL / SSL required:</label><br>
        <input type="checkbox" id="TLSSSL" name="TLSSSL"><br><br>
        <label for="receiverMAIL">receiver EMail:</label><br>
        <input type="text" id="receiverMAIL" name="TLSSSL"><br><br>
      </div>
    </div>
    <input type="submit" value="Submit">
  </form>
  <hr>


  <h2>Saved Modules</h2>
  <div id="savedModulesContainer"></div>
</body>
</html>